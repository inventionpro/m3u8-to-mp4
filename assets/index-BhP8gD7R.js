var S=Object.defineProperty;var _=t=>{throw TypeError(t)};var C=(t,e,r)=>e in t?S(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var l=(t,e,r)=>C(t,typeof e!="symbol"?e+"":e,r),N=(t,e,r)=>e.has(t)||_("Cannot "+r);var s=(t,e,r)=>(N(t,e,"read from private field"),r?r.call(t):e.get(t)),R=(t,e,r)=>e.has(t)?_("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,r),D=(t,e,r,o)=>(N(t,e,"write to private field"),o?o.call(t,r):e.set(t,r),r);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function r(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(n){if(n.ep)return;n.ep=!0;const a=r(n);fetch(n.href,a)}})();var i;(function(t){t.LOAD="LOAD",t.EXEC="EXEC",t.WRITE_FILE="WRITE_FILE",t.READ_FILE="READ_FILE",t.DELETE_FILE="DELETE_FILE",t.RENAME="RENAME",t.CREATE_DIR="CREATE_DIR",t.LIST_DIR="LIST_DIR",t.DELETE_DIR="DELETE_DIR",t.ERROR="ERROR",t.DOWNLOAD="DOWNLOAD",t.PROGRESS="PROGRESS",t.LOG="LOG",t.MOUNT="MOUNT",t.UNMOUNT="UNMOUNT"})(i||(i={}));const P=(()=>{let t=0;return()=>t++})(),v=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),F=new Error("called FFmpeg.terminate()");var f,m,h,w,p,y,d;class W{constructor(){R(this,f,null);R(this,m,{});R(this,h,{});R(this,w,[]);R(this,p,[]);l(this,"loaded",!1);R(this,y,()=>{s(this,f)&&(s(this,f).onmessage=({data:{id:e,type:r,data:o}})=>{switch(r){case i.LOAD:this.loaded=!0,s(this,m)[e](o);break;case i.MOUNT:case i.UNMOUNT:case i.EXEC:case i.WRITE_FILE:case i.READ_FILE:case i.DELETE_FILE:case i.RENAME:case i.CREATE_DIR:case i.LIST_DIR:case i.DELETE_DIR:s(this,m)[e](o);break;case i.LOG:s(this,w).forEach(n=>n(o));break;case i.PROGRESS:s(this,p).forEach(n=>n(o));break;case i.ERROR:s(this,h)[e](o);break}delete s(this,m)[e],delete s(this,h)[e]})});R(this,d,({type:e,data:r},o=[],n)=>s(this,f)?new Promise((a,c)=>{const u=P();s(this,f)&&s(this,f).postMessage({id:u,type:e,data:r},o),s(this,m)[u]=a,s(this,h)[u]=c,n==null||n.addEventListener("abort",()=>{c(new DOMException(`Message # ${u} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(v));l(this,"load",({classWorkerURL:e,...r}={},{signal:o}={})=>(s(this,f)||(D(this,f,e?new Worker(new URL(e,import.meta.url),{type:"module"}):new Worker(new URL("./worker-lPYB70QI.js",import.meta.url),{type:"module"})),s(this,y).call(this)),s(this,d).call(this,{type:i.LOAD,data:r},void 0,o)));l(this,"exec",(e,r=-1,{signal:o}={})=>s(this,d).call(this,{type:i.EXEC,data:{args:e,timeout:r}},void 0,o));l(this,"terminate",()=>{const e=Object.keys(s(this,h));for(const r of e)s(this,h)[r](F),delete s(this,h)[r],delete s(this,m)[r];s(this,f)&&(s(this,f).terminate(),D(this,f,null),this.loaded=!1)});l(this,"writeFile",(e,r,{signal:o}={})=>{const n=[];return r instanceof Uint8Array&&n.push(r.buffer),s(this,d).call(this,{type:i.WRITE_FILE,data:{path:e,data:r}},n,o)});l(this,"mount",(e,r,o)=>{const n=[];return s(this,d).call(this,{type:i.MOUNT,data:{fsType:e,options:r,mountPoint:o}},n)});l(this,"unmount",e=>{const r=[];return s(this,d).call(this,{type:i.UNMOUNT,data:{mountPoint:e}},r)});l(this,"readFile",(e,r="binary",{signal:o}={})=>s(this,d).call(this,{type:i.READ_FILE,data:{path:e,encoding:r}},void 0,o));l(this,"deleteFile",(e,{signal:r}={})=>s(this,d).call(this,{type:i.DELETE_FILE,data:{path:e}},void 0,r));l(this,"rename",(e,r,{signal:o}={})=>s(this,d).call(this,{type:i.RENAME,data:{oldPath:e,newPath:r}},void 0,o));l(this,"createDir",(e,{signal:r}={})=>s(this,d).call(this,{type:i.CREATE_DIR,data:{path:e}},void 0,r));l(this,"listDir",(e,{signal:r}={})=>s(this,d).call(this,{type:i.LIST_DIR,data:{path:e}},void 0,r));l(this,"deleteDir",(e,{signal:r}={})=>s(this,d).call(this,{type:i.DELETE_DIR,data:{path:e}},void 0,r))}on(e,r){e==="log"?s(this,w).push(r):e==="progress"&&s(this,p).push(r)}off(e,r){e==="log"?D(this,w,s(this,w).filter(o=>o!==r)):e==="progress"&&D(this,p,s(this,p).filter(o=>o!==r))}}f=new WeakMap,m=new WeakMap,h=new WeakMap,w=new WeakMap,p=new WeakMap,y=new WeakMap,d=new WeakMap;const M=new Error("failed to get response body reader"),X=new Error("failed to complete download"),k="Content-Length",x=t=>new Promise((e,r)=>{const o=new FileReader;o.onload=()=>{const{result:n}=o;n instanceof ArrayBuffer?e(new Uint8Array(n)):e(new Uint8Array)},o.onerror=n=>{var a,c;r(Error(`File could not be read! Code=${((c=(a=n==null?void 0:n.target)==null?void 0:a.error)==null?void 0:c.code)||-1}`))},o.readAsArrayBuffer(t)}),$=async t=>{let e;if(typeof t=="string")/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(t)?e=atob(t.split(",")[1]).split("").map(r=>r.charCodeAt(0)):e=await(await fetch(t)).arrayBuffer();else if(t instanceof URL)e=await(await fetch(t)).arrayBuffer();else if(t instanceof File||t instanceof Blob)e=await x(t);else return new Uint8Array;return new Uint8Array(e)},j=async(t,e)=>{var n;const r=await fetch(t);let o;try{const a=parseInt(r.headers.get(k)||"-1"),c=(n=r.body)==null?void 0:n.getReader();if(!c)throw M;const u=[];let E=0;for(;;){const{done:L,value:O}=await c.read(),A=O?O.length:0;if(L){if(a!=-1&&a!==E)throw X;e&&e({url:t,total:a,received:E,delta:A,done:L});break}u.push(O),E+=A,e&&e({url:t,total:a,received:E,delta:A,done:L})}const I=new Uint8Array(E);let b=0;for(const L of u)I.set(L,b),b+=L.length;o=I.buffer}catch(a){console.log("failed to send download progress event: ",a),o=await r.arrayBuffer()}return o},U=async(t,e,r=!1,o)=>{const n=r?await j(t,o):await(await fetch(t)).arrayBuffer(),a=new Blob([n],{type:e});return URL.createObjectURL(a)},g=new W;g.on("log",({message:t})=>{console.log(`[FFmpeg]: ${t}`)});const T="https://unpkg.com/@ffmpeg/core@0.12.2/dist/esm";(async()=>(await g.load({coreURL:await U(`${T}/ffmpeg-core.js`,"text/javascript"),wasmURL:await U(`${T}/ffmpeg-core.wasm`,"application/wasm")}),document.getElementById("loading").style.display="none"))();async function B(t){let e=await fetch(t);if(e=await e.text(),e.includes("#EXT-X-STREAM-INF")){console.log("Fetched playlist");let r=e.match(/^#EXT-X-STREAM-INF:.+?$/gm).map(E=>Number(E.match(/BANDWIDTH=[0-9]+?,/)[0].match(/[0-9]+/)[0])).sort((E,I)=>I-E)[0],o=new RegExp(`#EXT-X-STREAM-INF:.*?,BANDWIDTH=${r},.*?`),n=e.split(`
`).findIndex(E=>E.match(o));if(n<0)throw new Error("Playlist without biggest bandwidth video?");let a=e.split(`
`)[n+1],c=new URL(a,t).href;console.log("Fetching video: "+c);let u=await B(c);return[c,u[1]]}else return console.log("Fetched video"),[t,e]}async function G(t){const e=t[0].substring(0,t[0].lastIndexOf("/")+1),r=t[1].split(`
`),o=[];for(const n of r)if(n&&!n.startsWith("#")){const a=new URL(n,e).href;console.log(`Fetching segment: ${a}`),o.push({name:n,data:await $(a)})}return o}document.getElementById("convert").onclick=async function(){let t=document.getElementById("url").value,e=await B(t),r=await G(e);for(let{name:a,data:c}of r)await g.writeFile(a,c);await g.writeFile("playlist.m3u8",e[1]),await g.exec(["-allowed_extensions","ALL","-i","playlist.m3u8","-c","copy","-bsf:a","aac_adtstoasc","output.mp4"]);const o=await g.readFile("output.mp4"),n=new Blob([o.buffer],{type:"video/mp4"});document.getElementById("video").src=URL.createObjectURL(n)};