var P=Object.defineProperty;var _=t=>{throw TypeError(t)};var W=(t,e,n)=>e in t?P(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var l=(t,e,n)=>W(t,typeof e!="symbol"?e+"":e,n),U=(t,e,n)=>e.has(t)||_("Cannot "+n);var s=(t,e,n)=>(U(t,e,"read from private field"),n?n.call(t):e.get(t)),m=(t,e,n)=>e.has(t)?_("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),L=(t,e,n,o)=>(U(t,e,"write to private field"),o?o.call(t,n):e.set(t,n),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}})();var a;(function(t){t.LOAD="LOAD",t.EXEC="EXEC",t.FFPROBE="FFPROBE",t.WRITE_FILE="WRITE_FILE",t.READ_FILE="READ_FILE",t.DELETE_FILE="DELETE_FILE",t.RENAME="RENAME",t.CREATE_DIR="CREATE_DIR",t.LIST_DIR="LIST_DIR",t.DELETE_DIR="DELETE_DIR",t.ERROR="ERROR",t.DOWNLOAD="DOWNLOAD",t.PROGRESS="PROGRESS",t.LOG="LOG",t.MOUNT="MOUNT",t.UNMOUNT="UNMOUNT"})(a||(a={}));const C=(()=>{let t=0;return()=>t++})(),v=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),M=new Error("called FFmpeg.terminate()");var f,w,R,p,g,y,d;class X{constructor(){m(this,f,null);m(this,w,{});m(this,R,{});m(this,p,[]);m(this,g,[]);l(this,"loaded",!1);m(this,y,()=>{s(this,f)&&(s(this,f).onmessage=({data:{id:e,type:n,data:o}})=>{switch(n){case a.LOAD:this.loaded=!0,s(this,w)[e](o);break;case a.MOUNT:case a.UNMOUNT:case a.EXEC:case a.FFPROBE:case a.WRITE_FILE:case a.READ_FILE:case a.DELETE_FILE:case a.RENAME:case a.CREATE_DIR:case a.LIST_DIR:case a.DELETE_DIR:s(this,w)[e](o);break;case a.LOG:s(this,p).forEach(r=>r(o));break;case a.PROGRESS:s(this,g).forEach(r=>r(o));break;case a.ERROR:s(this,R)[e](o);break}delete s(this,w)[e],delete s(this,R)[e]})});m(this,d,({type:e,data:n},o=[],r)=>s(this,f)?new Promise((i,c)=>{const h=C();s(this,f)&&s(this,f).postMessage({id:h,type:e,data:n},o),s(this,w)[h]=i,s(this,R)[h]=c,r==null||r.addEventListener("abort",()=>{c(new DOMException(`Message # ${h} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(v));l(this,"load",({classWorkerURL:e,...n}={},{signal:o}={})=>(s(this,f)||(L(this,f,e?new Worker(new URL(e,import.meta.url),{type:"module"}):new Worker(new URL("./worker-BAOIWoxA.js",import.meta.url),{type:"module"})),s(this,y).call(this)),s(this,d).call(this,{type:a.LOAD,data:n},void 0,o)));l(this,"exec",(e,n=-1,{signal:o}={})=>s(this,d).call(this,{type:a.EXEC,data:{args:e,timeout:n}},void 0,o));l(this,"ffprobe",(e,n=-1,{signal:o}={})=>s(this,d).call(this,{type:a.FFPROBE,data:{args:e,timeout:n}},void 0,o));l(this,"terminate",()=>{const e=Object.keys(s(this,R));for(const n of e)s(this,R)[n](M),delete s(this,R)[n],delete s(this,w)[n];s(this,f)&&(s(this,f).terminate(),L(this,f,null),this.loaded=!1)});l(this,"writeFile",(e,n,{signal:o}={})=>{const r=[];return n instanceof Uint8Array&&r.push(n.buffer),s(this,d).call(this,{type:a.WRITE_FILE,data:{path:e,data:n}},r,o)});l(this,"mount",(e,n,o)=>{const r=[];return s(this,d).call(this,{type:a.MOUNT,data:{fsType:e,options:n,mountPoint:o}},r)});l(this,"unmount",e=>{const n=[];return s(this,d).call(this,{type:a.UNMOUNT,data:{mountPoint:e}},n)});l(this,"readFile",(e,n="binary",{signal:o}={})=>s(this,d).call(this,{type:a.READ_FILE,data:{path:e,encoding:n}},void 0,o));l(this,"deleteFile",(e,{signal:n}={})=>s(this,d).call(this,{type:a.DELETE_FILE,data:{path:e}},void 0,n));l(this,"rename",(e,n,{signal:o}={})=>s(this,d).call(this,{type:a.RENAME,data:{oldPath:e,newPath:n}},void 0,o));l(this,"createDir",(e,{signal:n}={})=>s(this,d).call(this,{type:a.CREATE_DIR,data:{path:e}},void 0,n));l(this,"listDir",(e,{signal:n}={})=>s(this,d).call(this,{type:a.LIST_DIR,data:{path:e}},void 0,n));l(this,"deleteDir",(e,{signal:n}={})=>s(this,d).call(this,{type:a.DELETE_DIR,data:{path:e}},void 0,n))}on(e,n){e==="log"?s(this,p).push(n):e==="progress"&&s(this,g).push(n)}off(e,n){e==="log"?L(this,p,s(this,p).filter(o=>o!==n)):e==="progress"&&L(this,g,s(this,g).filter(o=>o!==n))}}f=new WeakMap,w=new WeakMap,R=new WeakMap,p=new WeakMap,g=new WeakMap,y=new WeakMap,d=new WeakMap;var B;(function(t){t.MEMFS="MEMFS",t.NODEFS="NODEFS",t.NODERAWFS="NODERAWFS",t.IDBFS="IDBFS",t.WORKERFS="WORKERFS",t.PROXYFS="PROXYFS"})(B||(B={}));const x=new Error("failed to get response body reader"),k=new Error("failed to complete download"),$="Content-Length",j=t=>new Promise((e,n)=>{const o=new FileReader;o.onload=()=>{const{result:r}=o;r instanceof ArrayBuffer?e(new Uint8Array(r)):e(new Uint8Array)},o.onerror=r=>{var i,c;n(Error(`File could not be read! Code=${((c=(i=r==null?void 0:r.target)==null?void 0:i.error)==null?void 0:c.code)||-1}`))},o.readAsArrayBuffer(t)}),G=async t=>{let e;if(typeof t=="string")/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(t)?e=atob(t.split(",")[1]).split("").map(n=>n.charCodeAt(0)):e=await(await fetch(t)).arrayBuffer();else if(t instanceof URL)e=await(await fetch(t)).arrayBuffer();else if(t instanceof File||t instanceof Blob)e=await j(t);else return new Uint8Array;return new Uint8Array(e)},H=async(t,e)=>{var r;const n=await fetch(t);let o;try{const i=parseInt(n.headers.get($)||"-1"),c=(r=n.body)==null?void 0:r.getReader();if(!c)throw x;const h=[];let E=0;for(;;){const{done:O,value:A}=await c.read(),b=A?A.length:0;if(O){if(i!=-1&&i!==E)throw k;e&&e({url:t,total:i,received:E,delta:b,done:O});break}h.push(A),E+=b,e&&e({url:t,total:i,received:E,delta:b,done:O})}const I=new Uint8Array(E);let N=0;for(const O of h)I.set(O,N),N+=O.length;o=I.buffer}catch(i){console.log("failed to send download progress event: ",i),o=await n.arrayBuffer()}return o},S=async(t,e,n=!1,o)=>{const r=n?await H(t,o):await(await fetch(t)).arrayBuffer(),i=new Blob([r],{type:e});return URL.createObjectURL(i)},D=new X;D.on("log",({message:t})=>{console.log(`[FFmpeg]: ${t}`)});const T="https://unpkg.com/@ffmpeg/core@0.12.2/dist/esm";(async()=>(await D.load({coreURL:await S(`${T}/ffmpeg-core.js`,"text/javascript"),wasmURL:await S(`${T}/ffmpeg-core.wasm`,"application/wasm")}),document.getElementById("loading").style.display="none"))();function u(t){document.getElementById("status").innerText=t}async function F(t){u("Fetching...");let e=await fetch(t);if(e=await e.text(),e.includes("#EXT-X-STREAM-INF")){console.log("Fetched playlist"),u("Playlist fetched, fetching highest quality video...");let n=e.match(/^#EXT-X-STREAM-INF:.+?$/gm).map(E=>Number(E.match(/BANDWIDTH=[0-9]+?,/)[0].match(/[0-9]+/)[0])).sort((E,I)=>I-E)[0],o=new RegExp(`#EXT-X-STREAM-INF:.*?,BANDWIDTH=${n},.*?`),r=e.split(`
`).findIndex(E=>E.match(o));if(r<0)throw new Error("Playlist without biggest bandwidth video?");let i=e.split(`
`)[r+1],c=new URL(i,t).href;console.log("Fetching video: "+c),u("Video fetched");let h=await F(c);return[c,h[1]]}else return console.log("Fetched video"),u("Video fetched"),[t,e]}async function K(t){u("Fetching segments...");const e=t[0].substring(0,t[0].lastIndexOf("/")+1),n=t[1].split(`
`),o=[];for(let r=0;r<n.length;r++){let i=n[r];if(i&&!i.startsWith("#")){const c=new URL(i,e).href;console.log(`Fetching segment: ${c}`),u(`Fetching segment ${r}...`),o.push({name:i,data:await G(c)})}}return o}document.getElementById("convert").onclick=async function(){let t=document.getElementById("url").value,e=await F(t),n=await K(e);u("Writing files...");for(let{name:i,data:c}of n)await D.writeFile(i,c);u("Writing playlist..."),await D.writeFile("playlist.m3u8",e[1]),u("Converting..."),await D.exec(["-allowed_extensions","ALL","-i","playlist.m3u8","-c","copy","-bsf:a","aac_adtstoasc","output.mp4"]);const o=await D.readFile("output.mp4"),r=new Blob([o.buffer],{type:"video/mp4"});u("Done!"),document.getElementById("video").src=URL.createObjectURL(r)};
