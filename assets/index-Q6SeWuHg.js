var P=Object.defineProperty;var _=t=>{throw TypeError(t)};var C=(t,e,n)=>e in t?P(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var d=(t,e,n)=>C(t,typeof e!="symbol"?e+"":e,n),U=(t,e,n)=>e.has(t)||_("Cannot "+n);var s=(t,e,n)=>(U(t,e,"read from private field"),n?n.call(t):e.get(t)),m=(t,e,n)=>e.has(t)?_("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),L=(t,e,n,r)=>(U(t,e,"write to private field"),r?r.call(t,n):e.set(t,n),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();var a;(function(t){t.LOAD="LOAD",t.EXEC="EXEC",t.FFPROBE="FFPROBE",t.WRITE_FILE="WRITE_FILE",t.READ_FILE="READ_FILE",t.DELETE_FILE="DELETE_FILE",t.RENAME="RENAME",t.CREATE_DIR="CREATE_DIR",t.LIST_DIR="LIST_DIR",t.DELETE_DIR="DELETE_DIR",t.ERROR="ERROR",t.DOWNLOAD="DOWNLOAD",t.PROGRESS="PROGRESS",t.LOG="LOG",t.MOUNT="MOUNT",t.UNMOUNT="UNMOUNT"})(a||(a={}));const W=(()=>{let t=0;return()=>t++})(),v=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),x=new Error("called FFmpeg.terminate()");var E,p,h,g,O,A,f;class M{constructor(){m(this,E,null);m(this,p,{});m(this,h,{});m(this,g,[]);m(this,O,[]);d(this,"loaded",!1);m(this,A,()=>{s(this,E)&&(s(this,E).onmessage=({data:{id:e,type:n,data:r}})=>{switch(n){case a.LOAD:this.loaded=!0,s(this,p)[e](r);break;case a.MOUNT:case a.UNMOUNT:case a.EXEC:case a.FFPROBE:case a.WRITE_FILE:case a.READ_FILE:case a.DELETE_FILE:case a.RENAME:case a.CREATE_DIR:case a.LIST_DIR:case a.DELETE_DIR:s(this,p)[e](r);break;case a.LOG:s(this,g).forEach(o=>o(r));break;case a.PROGRESS:s(this,O).forEach(o=>o(r));break;case a.ERROR:s(this,h)[e](r);break}delete s(this,p)[e],delete s(this,h)[e]})});m(this,f,({type:e,data:n},r=[],o)=>s(this,E)?new Promise((i,c)=>{const l=W();s(this,E)&&s(this,E).postMessage({id:l,type:e,data:n},r),s(this,p)[l]=i,s(this,h)[l]=c,o==null||o.addEventListener("abort",()=>{c(new DOMException(`Message # ${l} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(v));d(this,"load",({classWorkerURL:e,...n}={},{signal:r}={})=>(s(this,E)||(L(this,E,e?new Worker(new URL(e,import.meta.url),{type:"module"}):new Worker(new URL("./worker-BAOIWoxA.js",import.meta.url),{type:"module"})),s(this,A).call(this)),s(this,f).call(this,{type:a.LOAD,data:n},void 0,r)));d(this,"exec",(e,n=-1,{signal:r}={})=>s(this,f).call(this,{type:a.EXEC,data:{args:e,timeout:n}},void 0,r));d(this,"ffprobe",(e,n=-1,{signal:r}={})=>s(this,f).call(this,{type:a.FFPROBE,data:{args:e,timeout:n}},void 0,r));d(this,"terminate",()=>{const e=Object.keys(s(this,h));for(const n of e)s(this,h)[n](x),delete s(this,h)[n],delete s(this,p)[n];s(this,E)&&(s(this,E).terminate(),L(this,E,null),this.loaded=!1)});d(this,"writeFile",(e,n,{signal:r}={})=>{const o=[];return n instanceof Uint8Array&&o.push(n.buffer),s(this,f).call(this,{type:a.WRITE_FILE,data:{path:e,data:n}},o,r)});d(this,"mount",(e,n,r)=>{const o=[];return s(this,f).call(this,{type:a.MOUNT,data:{fsType:e,options:n,mountPoint:r}},o)});d(this,"unmount",e=>{const n=[];return s(this,f).call(this,{type:a.UNMOUNT,data:{mountPoint:e}},n)});d(this,"readFile",(e,n="binary",{signal:r}={})=>s(this,f).call(this,{type:a.READ_FILE,data:{path:e,encoding:n}},void 0,r));d(this,"deleteFile",(e,{signal:n}={})=>s(this,f).call(this,{type:a.DELETE_FILE,data:{path:e}},void 0,n));d(this,"rename",(e,n,{signal:r}={})=>s(this,f).call(this,{type:a.RENAME,data:{oldPath:e,newPath:n}},void 0,r));d(this,"createDir",(e,{signal:n}={})=>s(this,f).call(this,{type:a.CREATE_DIR,data:{path:e}},void 0,n));d(this,"listDir",(e,{signal:n}={})=>s(this,f).call(this,{type:a.LIST_DIR,data:{path:e}},void 0,n));d(this,"deleteDir",(e,{signal:n}={})=>s(this,f).call(this,{type:a.DELETE_DIR,data:{path:e}},void 0,n))}on(e,n){e==="log"?s(this,g).push(n):e==="progress"&&s(this,O).push(n)}off(e,n){e==="log"?L(this,g,s(this,g).filter(r=>r!==n)):e==="progress"&&L(this,O,s(this,O).filter(r=>r!==n))}}E=new WeakMap,p=new WeakMap,h=new WeakMap,g=new WeakMap,O=new WeakMap,A=new WeakMap,f=new WeakMap;var B;(function(t){t.MEMFS="MEMFS",t.NODEFS="NODEFS",t.NODERAWFS="NODERAWFS",t.IDBFS="IDBFS",t.WORKERFS="WORKERFS",t.PROXYFS="PROXYFS"})(B||(B={}));const X=new Error("failed to get response body reader"),k=new Error("failed to complete download"),$="Content-Length",j=t=>new Promise((e,n)=>{const r=new FileReader;r.onload=()=>{const{result:o}=r;o instanceof ArrayBuffer?e(new Uint8Array(o)):e(new Uint8Array)},r.onerror=o=>{var i,c;n(Error(`File could not be read! Code=${((c=(i=o==null?void 0:o.target)==null?void 0:i.error)==null?void 0:c.code)||-1}`))},r.readAsArrayBuffer(t)}),G=async t=>{let e;if(typeof t=="string")/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(t)?e=atob(t.split(",")[1]).split("").map(n=>n.charCodeAt(0)):e=await(await fetch(t)).arrayBuffer();else if(t instanceof URL)e=await(await fetch(t)).arrayBuffer();else if(t instanceof File||t instanceof Blob)e=await j(t);else return new Uint8Array;return new Uint8Array(e)},H=async(t,e)=>{var o;const n=await fetch(t);let r;try{const i=parseInt(n.headers.get($)||"-1"),c=(o=n.body)==null?void 0:o.getReader();if(!c)throw X;const l=[];let w=0;for(;;){const{done:D,value:b}=await c.read(),N=b?b.length:0;if(D){if(i!=-1&&i!==w)throw k;e&&e({url:t,total:i,received:w,delta:N,done:D});break}l.push(b),w+=N,e&&e({url:t,total:i,received:w,delta:N,done:D})}const R=new Uint8Array(w);let y=0;for(const D of l)R.set(D,y),y+=D.length;r=R.buffer}catch(i){console.log("failed to send download progress event: ",i),r=await n.arrayBuffer()}return r},S=async(t,e,n=!1,r)=>{const o=n?await H(t,r):await(await fetch(t)).arrayBuffer(),i=new Blob([o],{type:e});return URL.createObjectURL(i)},I=new M;I.on("log",({message:t})=>{console.log(`[FFmpeg]: ${t}`)});const T="https://unpkg.com/@ffmpeg/core@0.12.2/dist/esm";(async()=>(await I.load({coreURL:await S(`${T}/ffmpeg-core.js`,"text/javascript"),wasmURL:await S(`${T}/ffmpeg-core.wasm`,"application/wasm")}),document.getElementById("loading").style.display="none"))();function u(t){document.getElementById("status").innerText=t}async function F(t){u("Fetching...");let e=document.getElementById("proxy").checked,n=await fetch(e?"https://api.fsh.plus/file?url="+encodeURIComponent(t):t);if(n=await n.text(),n.includes("#EXT-X-STREAM-INF")){console.log("Fetched playlist"),u("Playlist fetched, fetching highest quality video...");let r=n.match(/^#EXT-X-STREAM-INF:.+?$/gm).map(R=>Number(R.match(/BANDWIDTH=[0-9]+?,/)[0].match(/[0-9]+/)[0])).sort((R,y)=>y-R)[0],o=new RegExp(`#EXT-X-STREAM-INF:.*?,BANDWIDTH=${r},.*?`),i=n.split(`
`).findIndex(R=>R.match(o));if(i<0)throw new Error("Playlist without biggest bandwidth video?");let c=n.split(`
`)[i+1],l=new URL(c,t).href;console.log("Fetching video: "+l),u("Video fetched");let w=await F(l);return[l,w[1]]}else return console.log("Fetched video"),u("Video fetched"),[t,n]}async function K(t){u("Fetching segments...");const e=t[0].substring(0,t[0].lastIndexOf("/")+1),n=t[1].split(`
`),r=[];let o=document.getElementById("proxy").checked;for(let i=0;i<n.length;i++){let c=n[i];if(c&&!c.startsWith("#")){let l=new URL(c,e).href;console.log(`Fetching segment: ${l}`),u(`Fetching segment ${i}...`),o&&(l="https://api.fsh.plus/file?url="+encodeURIComponent(l)),r.push({name:c,data:await G(l)})}}return r}document.getElementById("convert").onclick=async function(){let t=document.getElementById("url").value,e=await F(t),n=await K(e);u("Writing files...");for(let{name:i,data:c}of n)await I.writeFile(i,c);u("Writing playlist..."),await I.writeFile("playlist.m3u8",e[1]),u("Converting..."),await I.exec(["-allowed_extensions","ALL","-i","playlist.m3u8","-c","copy","-bsf:a","aac_adtstoasc","output.mp4"]);const r=await I.readFile("output.mp4"),o=new Blob([r.buffer],{type:"video/mp4"});u("Done!"),document.getElementById("video").src=URL.createObjectURL(o)};
