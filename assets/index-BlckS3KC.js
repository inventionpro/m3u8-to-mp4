var C=Object.defineProperty;var N=t=>{throw TypeError(t)};var P=(t,e,n)=>e in t?C(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var l=(t,e,n)=>P(t,typeof e!="symbol"?e+"":e,n),U=(t,e,n)=>e.has(t)||N("Cannot "+n);var o=(t,e,n)=>(U(t,e,"read from private field"),n?n.call(t):e.get(t)),R=(t,e,n)=>e.has(t)?N("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),D=(t,e,n,s)=>(U(t,e,"write to private field"),s?s.call(t,n):e.set(t,n),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}})();var a;(function(t){t.LOAD="LOAD",t.EXEC="EXEC",t.WRITE_FILE="WRITE_FILE",t.READ_FILE="READ_FILE",t.DELETE_FILE="DELETE_FILE",t.RENAME="RENAME",t.CREATE_DIR="CREATE_DIR",t.LIST_DIR="LIST_DIR",t.DELETE_DIR="DELETE_DIR",t.ERROR="ERROR",t.DOWNLOAD="DOWNLOAD",t.PROGRESS="PROGRESS",t.LOG="LOG",t.MOUNT="MOUNT",t.UNMOUNT="UNMOUNT"})(a||(a={}));const F=(()=>{let t=0;return()=>t++})(),v=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),W=new Error("called FFmpeg.terminate()");var f,w,m,p,g,O,d;class x{constructor(){R(this,f,null);R(this,w,{});R(this,m,{});R(this,p,[]);R(this,g,[]);l(this,"loaded",!1);R(this,O,()=>{o(this,f)&&(o(this,f).onmessage=({data:{id:e,type:n,data:s}})=>{switch(n){case a.LOAD:this.loaded=!0,o(this,w)[e](s);break;case a.MOUNT:case a.UNMOUNT:case a.EXEC:case a.WRITE_FILE:case a.READ_FILE:case a.DELETE_FILE:case a.RENAME:case a.CREATE_DIR:case a.LIST_DIR:case a.DELETE_DIR:o(this,w)[e](s);break;case a.LOG:o(this,p).forEach(r=>r(s));break;case a.PROGRESS:o(this,g).forEach(r=>r(s));break;case a.ERROR:o(this,m)[e](s);break}delete o(this,w)[e],delete o(this,m)[e]})});R(this,d,({type:e,data:n},s=[],r)=>o(this,f)?new Promise((i,c)=>{const h=F();o(this,f)&&o(this,f).postMessage({id:h,type:e,data:n},s),o(this,w)[h]=i,o(this,m)[h]=c,r==null||r.addEventListener("abort",()=>{c(new DOMException(`Message # ${h} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(v));l(this,"load",({classWorkerURL:e,...n}={},{signal:s}={})=>(o(this,f)||(D(this,f,e?new Worker(new URL(e,import.meta.url),{type:"module"}):new Worker(new URL("./worker-lPYB70QI.js",import.meta.url),{type:"module"})),o(this,O).call(this)),o(this,d).call(this,{type:a.LOAD,data:n},void 0,s)));l(this,"exec",(e,n=-1,{signal:s}={})=>o(this,d).call(this,{type:a.EXEC,data:{args:e,timeout:n}},void 0,s));l(this,"terminate",()=>{const e=Object.keys(o(this,m));for(const n of e)o(this,m)[n](W),delete o(this,m)[n],delete o(this,w)[n];o(this,f)&&(o(this,f).terminate(),D(this,f,null),this.loaded=!1)});l(this,"writeFile",(e,n,{signal:s}={})=>{const r=[];return n instanceof Uint8Array&&r.push(n.buffer),o(this,d).call(this,{type:a.WRITE_FILE,data:{path:e,data:n}},r,s)});l(this,"mount",(e,n,s)=>{const r=[];return o(this,d).call(this,{type:a.MOUNT,data:{fsType:e,options:n,mountPoint:s}},r)});l(this,"unmount",e=>{const n=[];return o(this,d).call(this,{type:a.UNMOUNT,data:{mountPoint:e}},n)});l(this,"readFile",(e,n="binary",{signal:s}={})=>o(this,d).call(this,{type:a.READ_FILE,data:{path:e,encoding:n}},void 0,s));l(this,"deleteFile",(e,{signal:n}={})=>o(this,d).call(this,{type:a.DELETE_FILE,data:{path:e}},void 0,n));l(this,"rename",(e,n,{signal:s}={})=>o(this,d).call(this,{type:a.RENAME,data:{oldPath:e,newPath:n}},void 0,s));l(this,"createDir",(e,{signal:n}={})=>o(this,d).call(this,{type:a.CREATE_DIR,data:{path:e}},void 0,n));l(this,"listDir",(e,{signal:n}={})=>o(this,d).call(this,{type:a.LIST_DIR,data:{path:e}},void 0,n));l(this,"deleteDir",(e,{signal:n}={})=>o(this,d).call(this,{type:a.DELETE_DIR,data:{path:e}},void 0,n))}on(e,n){e==="log"?o(this,p).push(n):e==="progress"&&o(this,g).push(n)}off(e,n){e==="log"?D(this,p,o(this,p).filter(s=>s!==n)):e==="progress"&&D(this,g,o(this,g).filter(s=>s!==n))}}f=new WeakMap,w=new WeakMap,m=new WeakMap,p=new WeakMap,g=new WeakMap,O=new WeakMap,d=new WeakMap;const M=new Error("failed to get response body reader"),X=new Error("failed to complete download"),k="Content-Length",$=t=>new Promise((e,n)=>{const s=new FileReader;s.onload=()=>{const{result:r}=s;r instanceof ArrayBuffer?e(new Uint8Array(r)):e(new Uint8Array)},s.onerror=r=>{var i,c;n(Error(`File could not be read! Code=${((c=(i=r==null?void 0:r.target)==null?void 0:i.error)==null?void 0:c.code)||-1}`))},s.readAsArrayBuffer(t)}),j=async t=>{let e;if(typeof t=="string")/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(t)?e=atob(t.split(",")[1]).split("").map(n=>n.charCodeAt(0)):e=await(await fetch(t)).arrayBuffer();else if(t instanceof URL)e=await(await fetch(t)).arrayBuffer();else if(t instanceof File||t instanceof Blob)e=await $(t);else return new Uint8Array;return new Uint8Array(e)},G=async(t,e)=>{var r;const n=await fetch(t);let s;try{const i=parseInt(n.headers.get(k)||"-1"),c=(r=n.body)==null?void 0:r.getReader();if(!c)throw M;const h=[];let E=0;for(;;){const{done:L,value:A}=await c.read(),b=A?A.length:0;if(L){if(i!=-1&&i!==E)throw X;e&&e({url:t,total:i,received:E,delta:b,done:L});break}h.push(A),E+=b,e&&e({url:t,total:i,received:E,delta:b,done:L})}const I=new Uint8Array(E);let _=0;for(const L of h)I.set(L,_),_+=L.length;s=I.buffer}catch(i){console.log("failed to send download progress event: ",i),s=await n.arrayBuffer()}return s},T=async(t,e,n=!1,s)=>{const r=n?await G(t,s):await(await fetch(t)).arrayBuffer(),i=new Blob([r],{type:e});return URL.createObjectURL(i)},y=new x;y.on("log",({message:t})=>{console.log(`[FFmpeg]: ${t}`)});const B="https://unpkg.com/@ffmpeg/core@0.12.2/dist/esm";(async()=>(await y.load({coreURL:await T(`${B}/ffmpeg-core.js`,"text/javascript"),wasmURL:await T(`${B}/ffmpeg-core.wasm`,"application/wasm")}),document.getElementById("loading").style.display="none"))();function u(t){document.getElementById("status").innerText=t}async function S(t){u("Fetching...");let e=await fetch(t);if(e=await e.text(),e.includes("#EXT-X-STREAM-INF")){console.log("Fetched playlist"),u("Playlist fetched, fetching highest quality video...");let n=e.match(/^#EXT-X-STREAM-INF:.+?$/gm).map(E=>Number(E.match(/BANDWIDTH=[0-9]+?,/)[0].match(/[0-9]+/)[0])).sort((E,I)=>I-E)[0],s=new RegExp(`#EXT-X-STREAM-INF:.*?,BANDWIDTH=${n},.*?`),r=e.split(`
`).findIndex(E=>E.match(s));if(r<0)throw new Error("Playlist without biggest bandwidth video?");let i=e.split(`
`)[r+1],c=new URL(i,t).href;console.log("Fetching video: "+c),u("Video fetched");let h=await S(c);return[c,h[1]]}else return console.log("Fetched video"),u("Video fetched"),[t,e]}async function H(t){u("Fetching segments...");const e=t[0].substring(0,t[0].lastIndexOf("/")+1),n=t[1].split(`
`),s=[];for(let r=0;r<n.length;r++){let i=n[r];if(i&&!i.startsWith("#")){const c=new URL(i,e).href;console.log(`Fetching segment: ${c}`),u(`Fetching segment ${r}...`),s.push({name:i,data:await j(c)})}}return s}document.getElementById("convert").onclick=async function(){let t=document.getElementById("url").value,e=await S(t),n=await H(e);u("Writing files...");for(let{name:i,data:c}of n)await y.writeFile(i,c);u("Writing playlist..."),await y.writeFile("playlist.m3u8",e[1]),u("Converting..."),await y.exec(["-allowed_extensions","ALL","-i","playlist.m3u8","-c","copy","-bsf:a","aac_adtstoasc","output.mp4"]);const s=await y.readFile("output.mp4"),r=new Blob([s.buffer],{type:"video/mp4"});u("Done!"),document.getElementById("video").src=URL.createObjectURL(r)};