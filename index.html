<!DOCTYPE html>
<html lang="en">
  <head>
    <title>M3U8 To MP4 Online</title>
    <meta name="description" content="Convert m3u8 files into mp4s online.">

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:image" content="https://fsh.plus/fsh.png">
    <meta name="theme-color" content="#a89c9b">

    <link rel="stylesheet" href="https://fsh.plus/media/style.css">
    <style>
      body {
        display: flex;
        gap: 5px;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        width: 100vw;
        height: 100vh;
      }
      #loading {
        position: absolute;
        left: 0;
        top: 0;
        right: 0;
        bottom: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: var(--bg-1);
        z-index: 999;
      }
    </style>
  </head>
  <body>
    <div id="loading">
      <p>Loading FFmpeg, please wait...</p>
    </div>
    <label>URL: <input type="url" id="url"></label>
    <button id="convert">Convert</button>
    <br>
    <video controls id="video"></video>
    <script type="module">
      import { FFmpeg } from 'https://unpkg.com/@ffmpeg/ffmpeg@0.12.10/dist/esm/index.js';
      import { fetchFile, toBlobURL } from 'https://unpkg.com/@ffmpeg/util@0.12.1/dist/esm/index.js';

      const ffmpeg = new FFmpeg();
      ffmpeg.load({
        coreURL: await toBlobURL(`https://unpkg.com/@ffmpeg/core@0.12.6/dist/esm/ffmpeg-core.js`, 'text/javascript'),
        wasmURL: await toBlobURL(`https://unpkg.com/@ffmpeg/core@0.12.6/dist/esm/ffmpeg-core.wasm`, 'application/wasm'),
      })
        .then(()=>{
          document.getElementById('loading').style.display = 'none';
          document.getElementById('convert').onclick = async function(){
            await ffmpeg.writeFile('input.webm', await fetchFile(document.getElementById('url').value));
            await ffmpeg.exec(['-i', 'input.webm', '-c', 'copy', '-bsf:a aac_adtstoasc', 'output.mp4']);
            const data = await ffmpeg.readFile('output.mp4');
            document.getElementById('video').src = URL.createObjectURL(new Blob([data.buffer], {type: 'video/mp4'}));
          }
        })
    </script>
  </body>
</html>
